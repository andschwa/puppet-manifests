---
classes:
  - ghost
  - gitlab
  - mumble
  - postgresql
  - postgresql::globals
  - postgresql::server
  - prosody
  - nginx
  - redis
  - vsftpd

ghost::blogs:
  andrew:
    production_url: https://schwartzmeyer.com
  jackie:
    production_url: https://jackie.schwartzmeyer.com
    production_port: 2369

gitlab::git_email: git@suchcodemuchlove.com
gitlab::gitlab_branch: v6.7.2
gitlab::gitlabshell_branch: v1.9.1
gitlab::gitlab_backup: "%{gitlab::git_home}/backups"
gitlab::gitlab_dbtype: pgsql
gitlab::gitlab_dbname: git
gitlab::gitlab_dbuser: git
gitlab::gitlab_dbpwd: "%{hiera('gitlab_dbpwd')}"
gitlab::gitlab_domain: suchcodemuchlove.com
gitlab::gitlab_ssl: true
gitlab::gitlab_ssl_cert: '/etc/ssl/certs/suchcodemuchlove.com.crt'
gitlab::gitlab_ssl_key: '/etc/ssl/private/suchcodemuchlove.com.key'

mumble::snapshot: true

nginx::nginx_upstreams:
  schwartzmeyer:
    members:
      - localhost:2368
  jackie:
    members:
      - localhost:2369
nginx::nginx_vhosts:
  idahothegoodlife.com:
    www_root: '/var/www/idahothegoodlife.com'
    rewrite_www_to_non_www: true
  schwartzmeyer.com:
    proxy: http://schwartzmeyer
    proxy_set_header:
      - Host $http_host
      - X-Forwarded-Proto $scheme
      - X-Forwarded-For $proxy_add_x_forwarded_for
      - X-Real-IP $remote_addr
    ssl: true
    ssl_cert: '/etc/ssl/certs/schwartzmeyer.com.crt'
    ssl_key: '/etc/ssl/private/schwartzmeyer.com.key'
    rewrite_www_to_non_www: true
    rewrite_to_https: true
  jackie.schwartzmeyer.com:
    proxy: http://jackie
    proxy_set_header:
      - Host $http_host
      - X-Forwarded-Proto $scheme
      - X-Forwarded-For $proxy_add_x_forwarded_for
      - X-Real-IP $remote_addr
    ssl: true
    ssl_cert: '/etc/ssl/certs/schwartzmeyer.com.crt'
    ssl_key: '/etc/ssl/private/schwartzmeyer.com.key'
nginx::nginx_locations:
  schwartzmeyer_public:
    vhost: schwartzmeyer.com
    location: '/public/'
    location_alias: '/var/www/public/'
    location_cfg_append:
      autoindex: 'on'
    ssl: true

postgresql::globals::manage_package_repo: true
postgresql::globals::version: '9.3'
postgresql::dbs:
  git:
    user: git
    password: "%{hiera('gitlab_dbpwd')}"

person::groups:
  - git

ubuntu::location: http://mirrors.digitalocean.com/ubuntu/

ufw::allows:
  allow-ftp-data-from-all:
    port: 20
  allow-ftp-listen-from-all:
    port: 21
  allow-ftp-passive-from-all:
    port: 42000:42256
  allow-http-from-all:
    port: 80
  allow-https-from-all:
    port: 443
  allow-mumble-from-all:
    port: 64738
  allow-mumble-udp-from-all:
    proto: udp
    port: 64738

vsftpd::template: vsftpd/empty.conf.erb
vsftpd::directives:
  allow_anon_ssl: 'YES'
  connect_from_port_20: 'YES'
  dual_log_enable: 'YES'
  force_dot_files: 'YES'
  guest_enable: 'YES'
  hide_ids: 'YES'
  listen: 'YES'
  local_enable: 'YES'
  no_anon_password: 'YES'
  ssl_enable: 'YES'
  use_localtime: 'YES'
  write_enable: 'YES'
  virtual_use_local_privs: 'YES'
  anon_root: '/var/www/public'
  max_clients: 10
  pasv_min_port: 42000
  pasv_max_port: 42256
  ftpd_banner: Welcome to this awesome server, friend!
  local_root: '/var/www/virtual/$USER'
  nopriv_user: ftp
  rsa_cert_file: '/etc/ssl/certs/schwartzmeyer.com.crt'
  rsa_private_key_file: '/etc/ssl/private/schwartzmeyer.com.key'
  user_sub_token: '$USER'
